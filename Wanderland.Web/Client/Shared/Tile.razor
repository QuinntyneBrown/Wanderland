@using Wanderland.Web.Shared
@inject Wanderland.Web.Shared.IWanderlandHttpApiClient _apiClient
@inject Wanderland.Web.Client.Services.WanderlandHubClient _hubClient

<MudPaper Height="80px" 
          Width="80px" 
          Style='@($"background:{GetColorForTile()}")'>@($"Row: {Row}, Column: {Column}, Type: {TileType}")
</MudPaper>

@code {
    [Parameter]
    public int Row { get; set; }

    [Parameter]
    public int Column { get; set; }

    [Parameter]
    public string? WorldName { get; set; }

    private Wanderland.Web.Shared.Tile Model { get; set;  }
    private TileType TileType;
    private bool shouldRender = false;

    protected override bool ShouldRender() => shouldRender;

    protected override async Task OnParametersSetAsync()
    {
        if (!string.IsNullOrEmpty(WorldName))
        {
            Model = await _apiClient.GetTileCurrentState(WorldName, Row, Column);
            TileType = Model.Type;
            shouldRender = true;
        }
    }

    protected string GetColorForTile()
    {
        if (Model?.Type == TileType.Barrier)
            return Colors.BlueGrey.Darken4;

        return Colors.BlueGrey.Default;
    }
}
